# 📅 カレンダー管理機能 - 使い方ガイド

## 📋 目次

1. [概要](#概要)
2. [主な機能](#主な機能)
3. [使い方](#使い方)
4. [ビューモード](#ビューモード)
5. [AI機能](#ai機能)
6. [イベント種類](#イベント種類)
7. [よくある質問](#よくある質問)

---

## 概要

**カレンダー管理機能**は、不動産売買決済における全ての重要日程を視覚化し、効率的なスケジュール管理をサポートする機能です。

### ✨ 何ができる？

- 📅 **3つのビューモード**: 月間・週間・日別で自由に切替
- 🎨 **色分け表示**: イベント種類ごとに色で識別
- 🤖 **AIスケジュール提案**: 最適な業務計画を自動生成
- 📊 **統合ビュー**: 全案件の期限を一元管理
- 🔍 **詳細確認**: イベントクリックで詳細表示
- 🔄 **シームレス移動**: カレンダーから案件詳細へ直接移動

---

## 主な機能

### 1. 自動イベント抽出

システムが自動的に以下の情報をカレンダーに表示します：

✅ **契約日** - 案件の契約締結日  
✅ **決済日** - 残金決済予定日  
✅ **融資特約期限** - 融資承認の期限  
✅ **タスク期限** - 各タスクの完了期限

### 2. インテリジェント表示

- **色分け**: イベント種類ごとに異なる色で表示
  - 🔵 契約日: 青色
  - 🟢 決済日: 緑色
  - 🔴 融資特約期限: 赤色
  - 🟠 重要タスク: オレンジ色
  - 🟣 中程度タスク: 紫色
  - ⚪ 低優先度タスク: グレー

- **重要度マーク**: 重要な期限には特別なマークが付きます

### 3. AIスケジュール提案

Gemini AIが以下を分析して最適なスケジュールを提案：

- 📊 今後30日間のイベント分析
- ⚠️ 重要期限の優先順位付け
- 📈 業務負荷の可視化
- 💡 具体的な推奨アクション

---

## 使い方

### ステップ1: カレンダーへ移動

1. **ダッシュボードから**
   - 右上の「📅 カレンダー」ボタンをクリック

2. **直接アクセス**
   - URL: `/calendar`

### ステップ2: ビューモードを選択

ヘッダーのボタンでビューを切替：

| ボタン | ビュー | 用途 |
|--------|--------|------|
| 📅 月 | 月間ビュー | 全体像の把握 |
| 🕐 週 | 週間ビュー | 週単位の詳細 |
| 📋 日 | 日別ビュー | 一日の詳細スケジュール |

### ステップ3: 日付を移動

- **← → ボタン**: 前月/次月、前週/次週に移動
- **今日ボタン**: 現在日に戻る
- **日付クリック**: 月間ビューで日付をクリックすると日別ビューに切替

### ステップ4: イベントを確認

1. **月間ビュー**
   - イベントバッジをクリックで詳細表示
   - 1日3件まで表示、それ以上は「+N more」

2. **週間ビュー**
   - 時間軸でイベントを表示
   - イベントをクリックで詳細表示

3. **日別ビュー**
   - イベント種類ごとにグループ化
   - 「案件を表示」で案件詳細へ移動

### ステップ5: AIスケジュール提案を利用

1. **「⚡ AI提案」ボタンをクリック**
2. AIが今後30日間を分析
3. 提案バナーに以下が表示：
   - スケジュール全体の要約
   - 具体的な推奨事項リスト
   - 重要日の警告
   - 業務負荷の分析

---

## ビューモード

### 📅 月間ビュー

**特徴**:
- 1ヶ月分のカレンダーをグリッド表示
- 各日付に最大3件のイベントを表示
- 今日の日付は青枠でハイライト
- 前月・次月の日付は薄く表示

**使い方**:
- 日付をクリック: 日別ビューに切替
- イベントバッジをクリック: 詳細モーダル表示
- 月移動: ← → ボタン

**適している場面**:
- 月全体のスケジュール確認
- 複数案件の期限を俯瞰
- 空いている日の確認

### 🕐 週間ビュー

**特徴**:
- 1週間分を時間軸で表示
- 縦軸: 時間（0:00-24:00）
- 横軸: 曜日（日-土）
- 今日の列は青背景でハイライト

**使い方**:
- イベントをクリック: 詳細モーダル表示
- 週移動: ← → ボタン

**適している場面**:
- 週単位の詳細計画
- 時間配分の確認
- 同日複数イベントの確認

### 📋 日別ビュー

**特徴**:
- 選択した日のイベントをリスト表示
- イベント種類ごとにグループ化
- 各イベントの詳細情報を表示
- 「案件を表示」ボタンで案件へ移動

**使い方**:
- イベントカードをクリック: 詳細モーダル表示
- 「案件を表示」ボタン: 案件詳細ページへ移動

**適している場面**:
- 一日の詳細スケジュール確認
- 当日のタスク整理
- 案件への直接アクセス

---

## AI機能

### AIスケジュール提案

**機能概要**:
Google Gemini AIが今後30日間のスケジュールを分析し、最適な業務計画を提案します。

**分析内容**:

1. **重要期限の優先順位付け**
   - 融資特約期限の緊急度評価
   - 決済日までの準備タスク確認
   - 複数期限の調整提案

2. **タスクの適切な分散配置**
   - 業務負荷の均等化
   - リソースの最適配分
   - ボトルネックの特定

3. **複数案件の調整**
   - 同日に重なる案件の警告
   - 優先順位の提案
   - 効率的な対応順序

4. **リスクの高い期間の警告**
   - 高負荷日の特定
   - 事前準備の推奨
   - 余裕を持った計画提案

**出力形式**:

```
📊 スケジュール全体の要約
今後30日間で5件の重要期限があります。特に12月15日(融資特約期限)と
12月20日(決済日)は準備が必要です。

💡 推奨事項
1. 12月13日までに融資承認状況を確認しましょう
2. 12月18日までに決済必要書類を準備しましょう
3. 12月22日は複数案件が重なるため、午前中にA案件を優先しましょう

⚠️ 重要日
- 2025-12-15: 融資特約期限（A様邸）- 事前確認必須
- 2025-12-20: 決済日（B様邸）- 書類準備完了確認
- 2025-12-22: 3案件同日対応 - スケジュール調整推奨
```

**使用タイミング**:
- 月初めに月間計画を立てるとき
- 新規案件が追加されたとき
- スケジュールが混雑してきたとき
- 重要期限が近づいたとき

---

## イベント種類

### 契約日 🔵

**表示色**: 青 (#3b82f6)

**内容**: 売買契約を締結した日

**重要性**: 中

**関連アクション**:
- 契約書の内容確認
- 手付金の受領確認
- 融資申込のスタート

### 決済日 🟢

**表示色**: 緑 (#10b981)

**内容**: 残金決済と物件引渡しを行う日

**重要性**: 最高

**関連アクション**:
- 決済必要書類の最終確認
- 司法書士との打ち合わせ
- 金融機関との調整
- 鍵の引渡し準備

### 融資特約期限 🔴

**表示色**: 赤 (#ef4444)

**内容**: 融資承認を得る必要がある期限

**重要性**: 最高

**関連アクション**:
- 金融機関への確認
- 融資承認状況の把握
- 期限延長の交渉（必要時）
- 買主への状況報告

### タスク期限 🟠🟣⚪

**表示色**: 
- 高優先度: オレンジ (#f59e0b)
- 中優先度: 紫 (#8b5cf6)
- 低優先度: グレー (#6b7280)

**内容**: 各種タスクの完了期限

**重要性**: タスクの優先度による

**関連アクション**:
- タスクの完了
- 進捗確認
- 必要に応じて期限調整

---

## よくある質問

### Q1: カレンダーに表示されないイベントがあります

**A**: 以下を確認してください：
- 案件の日付情報が正しく入力されているか
- タスクが「完了」になっていないか（完了タスクは非表示）
- フィルター設定で該当タイプが有効になっているか

### Q2: イベントが多すぎて見づらい

**A**: 以下の方法をお試しください：
- 週間ビューまたは日別ビューに切替
- フィルター機能で表示するイベントを絞り込む
- 月間ビューでは1日3件まで表示、残りは「+N more」で集約

### Q3: AIスケジュール提案が生成されない

**A**: 以下を確認してください：
- Gemini APIキーが設定されているか（backend/.env）
- インターネット接続が正常か
- ブラウザのコンソールにエラーメッセージがないか

エラー時は自動的にフォールバック提案が表示されます。

### Q4: 過去の日付も表示されますか？

**A**: はい、月間ビューでは前月の日付も薄く表示されます。ただし、完了したタスクは表示されません。

### Q5: カレンダーから案件詳細に移動できますか？

**A**: はい、以下の方法で移動できます：
- イベントをクリックしてモーダルを開く
- モーダル内の「案件詳細を表示」ボタンをクリック

または、日別ビューの各イベントカードの「案件を表示」ボタンをクリック。

### Q6: スマートフォンでも使えますか？

**A**: はい、レスポンシブデザインに対応しています。画面サイズに応じて表示が最適化されます。

### Q7: イベントの色を変更できますか？

**A**: 現在、イベントタイプごとに色が固定されています。カスタマイズ機能は今後の更新で追加予定です。

### Q8: 複数案件が同じ日にある場合は？

**A**: 
- 月間ビュー: 縦に並んで表示（最大3件、以降は「+N more」）
- 週間ビュー: 縦にずらして表示
- 日別ビュー: リストで全て表示

AIスケジュール提案機能が同日複数案件を検出し、対応優先順位を提案します。

---

## 技術詳細

### フロントエンド実装

**ファイル**: `frontend/src/pages/Calendar.jsx`

**主要コンポーネント**:
- `Calendar` - メインコンポーネント
- `MonthView` - 月間ビューコンポーネント
- `WeekView` - 週間ビューコンポーネント
- `DayView` - 日別ビューコンポーネント
- `EventModal` - イベント詳細モーダル

**使用ライブラリ**:
- `date-fns` - 日付操作とフォーマット
- `lucide-react` - アイコン
- `react-router-dom` - ルーティング

**データフロー**:
```
mockData → calendarEvents (useMemo)
         → ビューモード別にフィルタリング
         → 表示
```

### バックエンド実装

**ファイル**: 
- `backend/src/services/scheduleService.js` - AIロジック
- `backend/src/routes/scheduleRoutes.js` - APIエンドポイント

**API エンドポイント**:
- `POST /api/schedule/suggest` - スケジュール提案
- `POST /api/schedule/suggest-tasks` - タスクスケジュール提案
- `GET /api/schedule/health` - ヘルスチェック

**Gemini AI統合**:
```javascript
// プロンプト構築
const prompt = `
  不動産売買決済業務の専門家として、
  スケジュールを分析して最適な計画を提案
`;

// API呼び出し
const result = await model.generateContent(prompt);
```

---

## ショートカットキー（今後実装予定）

| キー | 動作 |
|------|------|
| `T` | 今日に移動 |
| `M` | 月間ビュー |
| `W` | 週間ビュー |
| `D` | 日別ビュー |
| `←` | 前の期間へ |
| `→` | 次の期間へ |
| `ESC` | モーダルを閉じる |

---

## まとめ

カレンダー管理機能により、不動産決済業務の全ての重要日程を一元管理できます：

✅ **視覚的管理**: 3つのビューモードで自由に切替  
✅ **自動抽出**: 案件情報から自動でイベント生成  
✅ **AI支援**: 最適なスケジュールを自動提案  
✅ **シームレス統合**: ダッシュボードや案件詳細との連携  
✅ **レスポンシブ**: PC・タブレット・スマホ対応

効率的なスケジュール管理で、スムーズな決済業務を実現しましょう！

---

**作成日**: 2025-11-12  
**バージョン**: 1.0.0  
**関連ドキュメント**:
- [README.md](../README.md) - システム全体のドキュメント
- [AI_RISK_ALERT_GUIDE.md](./AI_RISK_ALERT_GUIDE.md) - AIリスクアラート機能
- [AI_OCR_GUIDE.md](./AI_OCR_GUIDE.md) - AI契約書OCR機能
- [AI_EMAIL_GUIDE.md](./AI_EMAIL_GUIDE.md) - AIメール生成機能
